<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æµ‹æµ‹ä½ æ˜¯ä¸æ˜¯çŒª - å¹»ç¯ç‰‡æ¨¡å¼</title>
  <!-- Tailwind CSS v3 -->
  <script src="https://cdn.tailwindcss.com"></script>

  
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#FFB6C1', // æµ…ç²‰è‰²
            secondary: '#F5F5F5', // æµ…ç°è‰²
            accent: '#FF69B4', // äº®ç²‰è‰²
          },
          fontFamily: {
            sans: ['Arial Rounded MT Bold', 'Avenir', 'Helvetica', 'Arial', 'sans-serif'],
          },
          animation: {
            'bounce-slow': 'bounce 2s infinite',
            'wiggle': 'wiggle 1s ease-in-out infinite',
            'pulse-slow': 'pulse 3s infinite',
            'fade-in': 'fadeIn 0.5s ease-in-out',
            'slide-in': 'slideIn 0.5s ease-in-out',
          },
          keyframes: {
            wiggle: {
              '0%, 100%': { transform: 'rotate(-3deg)' },
              '50%': { transform: 'rotate(3deg)' },
            },
            fadeIn: {
              '0%': { opacity: '0' },
              '100%': { opacity: '1' },
            },
            slideIn: {
              '0%': { transform: 'translateY(20px)', opacity: '0' },
              '100%': { transform: 'translateY(0)', opacity: '1' },
            }
          }
        }
      }
    }
  </script>
  
  <style type="text/tailwindcss">
    @layer utilities {
      .text-shadow {
        text-shadow: 0 2px 4px rgba(0,0,0,0.1);
      }
      .text-shadow-lg {
        text-shadow: 0 4px 8px rgba(0,0,0,0.12), 0 2px 4px rgba(0,0,0,0.08);
      }
      .progress-ring-circle {
        transition: stroke-dashoffset 0.35s;
        transform: rotate(-90deg);
        transform-origin: 50% 50%;
      }
    }
    
    body {
      touch-action: none; /* é˜²æ­¢é•¿æŒ‰å¼¹å‡ºèœå• */
      user-select: none; /* é˜²æ­¢æ–‡æœ¬é€‰æ‹© */
      -webkit-tap-highlight-color: transparent; /* ç§»é™¤ç‚¹å‡»é«˜äº® */
    }
    
    @keyframes float {
      0% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
      100% { transform: translateY(0px); }
    }
    
    .float-animation {
      animation: float 3s ease-in-out infinite;
    }
    
    .progress-container {
      position: relative;
      width: 200px;
      height: 200px;
    }
    
    .progress-ring {
      transform: rotate(-90deg);
    }
    
    .progress-text {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 1.5rem;
      font-weight: bold;
    }
    
    .press-hint {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
      pointer-events: none;
    }
    
    /* å¹»ç¯ç‰‡æ ·å¼ */
    .slideshow-modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.8);
      z-index: 1000;
      display: flex;
      justify-content: center;
      align-items: center;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }
    
    .slideshow-modal.active {
      opacity: 1;
      visibility: visible;
    }
    
    .slideshow-content {
      background: white;
      border-radius: 24px;
      padding: 30px;
      width: 90%;
      max-width: 400px;
      text-align: center;
      transform: scale(0.8);
      transition: transform 0.3s ease;
    }
    
    .slideshow-modal.active .slideshow-content {
      transform: scale(1);
    }
    
    .slideshow-counter {
      background: #FFB6C1;
      color: white;
      border-radius: 20px;
      padding: 5px 15px;
      font-size: 14px;
      font-weight: bold;
      display: inline-block;
      margin-bottom: 20px;
    }
    
    .slideshow-controls {
      display: flex;
      gap: 10px;
      justify-content: center;
      margin-top: 25px;
    }
    
    .slideshow-button {
      padding: 10px 20px;
      border-radius: 50px;
      font-weight: bold;
      transition: all 0.3s;
      border: none;
      cursor: pointer;
    }
    
    .slideshow-button.primary {
      background: #FFB6C1;
      color: white;
    }
    
    .slideshow-button.secondary {
      background: #F5F5F5;
      color: #333;
    }
    
    .slideshow-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
  </style>
</head>
<body class="bg-secondary min-h-screen flex flex-col items-center justify-center p-4">
  <div class="container max-w-md mx-auto text-center">
    <!-- æ ‡é¢˜ -->
    <h1 class="text-4xl md:text-5xl font-bold mb-6 text-primary text-shadow-lg">
      æµ‹æµ‹ä½ æ˜¯ä¸æ˜¯çŒª <span class="text-accent">ğŸ·</span>
    </h1>
    
    <!-- åŠŸèƒ½æŒ‰é’® -->
    <div class="mb-6 flex gap-4 justify-center">
      <button id="start-slideshow" class="bg-accent text-white py-3 px-8 rounded-full font-bold hover:bg-accent/80 transition-all transform hover:scale-105 active:scale-95 shadow-lg">
        å¹»ç¯ç‰‡æ¨¡å¼
      </button>
    </div>
    
    <!-- ä¸»å†…å®¹åŒº -->
    <div class="bg-white rounded-3xl shadow-lg p-6 mb-8 transform transition-all duration-300 hover:shadow-xl">
      <!-- æµ‹è¯•åŒºåŸŸ -->
      <div id="test-area" class="mb-6">
        <div class="progress-container mx-auto">
          <!-- åœ†å½¢è¿›åº¦æ¡ -->
          <svg class="progress-ring" width="200" height="200">
            <circle
              class="text-gray-200"
              stroke-width="10"
              stroke="currentColor"
              fill="transparent"
              r="85"
              cx="100"
              cy="100"
            />
            <circle
              id="progress-circle"
              class="text-primary progress-ring-circle"
              stroke-width="10"
              stroke="currentColor"
              fill="transparent"
              r="85"
              cx="100"
              cy="100"
              stroke-dasharray="534.07"
              stroke-dashoffset="534.07"
            />
          </svg>
          
          <!-- é•¿æŒ‰æç¤º -->
          <div id="press-hint" class="press-hint">
            <div class="text-5xl mb-2">ğŸ‘‡</div>
            <p class="text-lg text-gray-600">é•¿æŒ‰è¿™é‡Œæµ‹è¯•</p>
          </div>
          
          <!-- è¿›åº¦æ–‡æœ¬ -->
          <div id="progress-text" class="progress-text hidden">
            <span id="progress-percentage">0%</span>
          </div>
        </div>
        
        <!-- æç¤ºæ–‡å­— -->
        <p id="instruction" class="text-gray-600 mt-6">
          é•¿æŒ‰å±å¹•ä¸­é—´åŒºåŸŸï¼Œçœ‹çœ‹ä½ æ˜¯ä»€ä¹ˆçŒªï¼
        </p>
      </div>
      
      <!-- ç»“æœåŒºåŸŸ (åˆå§‹éšè—) -->
      <div id="result-area" class="hidden">
        <div class="bg-primary/10 rounded-2xl p-6 flex flex-col items-center justify-center h-64 mb-6">
          <img id="result-emoji" class="w-24 h-24 mb-4 float-animation" src="image/pig.png" alt="çŒª">
          <h2 id="result-title" class="text-2xl font-bold text-gray-800 mb-2">çŒª</h2>
          <p id="result-description" class="text-gray-600">
            ä½ æ˜¯ä¸€åªå¯çˆ±çš„å°çŒªçŒªï¼
          </p>
        </div>
        
        <button id="retest-button" class="hidden bg-primary text-white py-2 px-6 rounded-full font-medium mb-4 hover:bg-primary/80 transition-colors">
          é‡æ–°æµ‹è¯•
        </button>
        
        <p class="text-gray-500 text-sm">
          æç¤ºï¼šç»“æœå·²ä¿å­˜ï¼Œåˆ·æ–°ä¸ä¼šæ”¹å˜å“¦ï¼
        </p>
      </div>
    </div>
    
    <!-- é¡µè„š -->
    <footer class="text-gray-500 text-sm">
      <p>ä½œè€…ï¼šnanan <span class="text-primary">ğŸ½</span></p>
      <p class="mt-2">å…±æ”¶å½• <span id="pig-count" class="font-bold text-accent">22</span> ç§çŒªçŒªç±»å‹</p>
    </footer>
  </div>

  <!-- å¹»ç¯ç‰‡æ¨¡æ€æ¡† -->
  <div id="slideshow-modal" class="slideshow-modal">
    <div class="slideshow-content animate-slide-in">
      <div class="slideshow-counter">
        <span id="current-index">1</span> / <span id="total-count">22</span>
      </div>
      
      <div class="bg-primary/10 rounded-2xl p-8 mb-6">
        <img id="slideshow-image" class="w-32 h-32 mx-auto mb-6 float-animation" src="image/pig.png" alt="çŒª">
        <h2 id="slideshow-title" class="text-3xl font-bold text-gray-800 mb-3">çŒª</h2>
        <p id="slideshow-description" class="text-gray-600 text-lg">
          æ™®é€šå°çŒª
        </p>
      </div>
      
      <div class="slideshow-controls">
        <button id="prev-pig" class="slideshow-button secondary">
          ä¸Šä¸€ä¸ª
        </button>
        <button id="pause-resume" class="slideshow-button primary">
          æš‚åœ
        </button>
        <button id="next-pig" class="slideshow-button secondary">
          ä¸‹ä¸€ä¸ª
        </button>
      </div>
      
      <div class="mt-6">
        <button id="close-slideshow" class="text-gray-500 hover:text-gray-700 underline text-sm">
          å…³é—­å¹»ç¯ç‰‡
        </button>
      </div>
    </div>
  </div>

  <script>
    // ç»“æœæ•°æ®
    const pigResults = [
      {
        id: "human",
        name: "äººç±»",
        emoji: "ğŸ‘¤",
        description: "æ£€æµ‹ä¸å‡ºçŒªå…ƒç´ ï¼Œæ˜¯äººç±»å—ï¼Ÿ",
        analysis: ""
      },
      {
        id: "pig",
        name: "çŒª",
        emoji: "ğŸ·",
        description: "æ™®é€šå°çŒª",
        analysis: ""
      },
      {
        id: "black-pig",
        name: "å°é»‘çŒª",
        emoji: "ğŸ–",
        description: "å°é»‘çŒªï¼Œå¤å‡ºçŒªè„šäº†",
        analysis: ""
      },
      {
        id: "wild-boar",
        name: "é‡çŒª",
        emoji: "ğŸ—",
        description: "ä½ æ˜¯ä¸€åªå‹‡çŒ›çš„é‡çŒªï¼",
        analysis: ""
      },
      {
        id: "zhuge-liang",
        name: "çŒªè‘›äº®",
        emoji: "ğŸ·ğŸ§ ",
        description: "çŒªé‡Œæœ€èªæ˜çš„ä¸€ä¸ª",
        analysis: ""
      },
      {
        id: "pig-stamp",
        name: "çŒªåœ†ç« ",
        emoji: "ğŸ·ğŸ”´",
        description: "ã€ŠçŒªåœˆé‚£äº›äº‹ã€‹",
        analysis: ""
      },
      {
        id: "zombie-pig",
        name: "åƒµå°¸çŒª",
        emoji: "ğŸ§ŸğŸ·",
        description: "å–œæ¬¢çš„é£Ÿç‰©æ˜¯çŒªè„‘",
        analysis: ""
      },
      {
        id: "skeleton-pig",
        name: "éª·é«…çŒª",
        emoji: "ğŸ’€ğŸ·",
        description: "èµ„æ·±ä¸æ­»æ—",
        analysis: ""
      },
      {
        id: "pig-human",
        name: "çŒªäºº",
        emoji: "ğŸ·ğŸ‘¤",
        description: "ä½ æ˜¯çŒªè¿˜æ˜¯äººï¼Ÿ",
        analysis: ""
      },
      {
        id: "demon-pig",
        name: "æ¶é­”çŒª",
        emoji: "ğŸ˜ˆğŸ·",
        description: "æ»¡è‚šå­åå¿ƒçœ¼",
        analysis: ""
      },
      {
        id: "heaven-pig",
        name: "å¤©å ‚çŒª",
        emoji: "ğŸ˜‡ğŸ·",
        description: "ä¼¼äº†å–µ~",
        analysis: ""
      },
      {
        id: "explosive-pig",
        name: "çˆ†ç ´å°çŒª",
        emoji: "ğŸ’£ğŸ·",
        description: "æˆ‘è·Ÿä½ çˆ†äº†ï¼",
        analysis: ""
      },
      {
        id: "black-white-pig",
        name: "é»‘ç™½çŒª",
        emoji: "âš«âšªğŸ·",
        description: "ä¸²å­",
        analysis: ""
      },
      {
        id: "pork-skewer",
        name: "çŒªè‚‰ä¸²",
        emoji: "ğŸ¢",
        description: "çœŸæ­£çš„ä¸²å­",
        analysis: ""
      },
      {
        id: "magic-pig",
        name: "é­”æ³•å°‘çŒª",
        emoji: "ğŸª„ğŸ·",
        description: "é©¬çŒªçƒ§é…’",
        analysis: ""
      },
      {
        id: "mechanical-pig",
        name: "æœºæ¢°çŒª",
        emoji: "ğŸ¤–ğŸ·",
        description: "äººæœº",
        analysis: ""
      },
      {
        id: "pig-ball",
        name: "çŒªçŒªçƒ",
        emoji: "ğŸ€ğŸ·",
        description: "æ»šäº†",
        analysis: ""
      },
      {
        id: "doll-pig",
        name: "ç©å¶çŒª",
        emoji: "ğŸ§¸ğŸ·",
        description: "fufuå°çŒª",
        analysis: ""
      },
      {
        id: "soul-pig",
        name: "çµé­‚çŒª",
        emoji: "ğŸ‘»ğŸ·",
        description: "ä»å†¥ç•Œå½’æ¥çš„çŒª",
        analysis: ""
      },
      {
        id: "crystal-pig",
        name: "æ°´æ™¶çŒª",
        emoji: "ğŸ’ğŸ·",
        description: "çè´µåˆè„†å¼±çš„å°çŒª",
        analysis: ""
      },
      {
        id: "snow-pig",
        name: "é›ªçŒª",
        emoji: "â„ï¸ğŸ·",
        description: "æ´ç™½çš„é›ªçŒª",
        analysis: ""
      },
      {
        id: "pig-cat",
        name: "çŒªå’ª",
        emoji: "ğŸ·ğŸ±",
        description: "ä½ æ˜¯ä¸€åªå¯çˆ±çš„çŒªå’ªï¼",
        analysis: ""
      }
    ];

    // DOM å…ƒç´ 
    const testArea = document.getElementById('test-area');
    const resultArea = document.getElementById('result-area');
    const progressCircle = document.getElementById('progress-circle');
    const progressText = document.getElementById('progress-text');
    const progressPercentage = document.getElementById('progress-percentage');
    const pressHint = document.getElementById('press-hint');
    const instruction = document.getElementById('instruction');
    const resultEmoji = document.getElementById('result-emoji');
    const resultTitle = document.getElementById('result-title');
    const resultDescription = document.getElementById('result-description');
    const retestButton = document.getElementById('retest-button');
    
    // å¹»ç¯ç‰‡ç›¸å…³DOMå…ƒç´ 
    const startSlideshowBtn = document.getElementById('start-slideshow');
    const slideshowModal = document.getElementById('slideshow-modal');
    const slideshowImage = document.getElementById('slideshow-image');
    const slideshowTitle = document.getElementById('slideshow-title');
    const slideshowDescription = document.getElementById('slideshow-description');
    const currentIndexEl = document.getElementById('current-index');
    const totalCountEl = document.getElementById('total-count');
    const prevPigBtn = document.getElementById('prev-pig');
    const nextPigBtn = document.getElementById('next-pig');
    const pauseResumeBtn = document.getElementById('pause-resume');
    const closeSlideshowBtn = document.getElementById('close-slideshow');
    const pigCount = document.getElementById('pig-count');
    
    // è¿›åº¦æ¡å‚æ•°
    const circumference = 2 * Math.PI * 85; // åœ†çš„å‘¨é•¿
    const requiredHoldTime = 3000; // é•¿æŒ‰æ‰€éœ€æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
    let startTime = 0;
    let isHolding = false;
    let progressInterval;
    
    // å¹»ç¯ç‰‡ç›¸å…³å˜é‡
    let currentSlideshowIndex = 0;
    let isSlideshowPlaying = true;
    let slideshowInterval;
    const slideshowSpeed = 2000; // æ¯å¼ å›¾ç‰‡æ˜¾ç¤ºæ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
    
    // åˆå§‹åŒ–
    function init() {
      // æ›´æ–°çŒªçŒªæ•°é‡
      pigCount.textContent = pigResults.length;
      totalCountEl.textContent = pigResults.length;
      
      // åˆå§‹åŒ–è¿›åº¦æ¡
      progressCircle.style.strokeDasharray = `${circumference} ${circumference}`;
      progressCircle.style.strokeDashoffset = circumference;
      
      // æ£€æŸ¥æ˜¯å¦å·²æœ‰ç»“æœ
      try {
        const savedResult = localStorage.getItem('pigTestResult');
        if (savedResult) {
          showResult(JSON.parse(savedResult));
        }
      } catch (error) {
        console.error('è¯»å–æœ¬åœ°å­˜å‚¨å¤±è´¥:', error);
        localStorage.removeItem('pigTestResult');
      }
      
      // åˆå§‹åŒ–å¹»ç¯ç‰‡
      initSlideshow();
    }
    
    // åˆå§‹åŒ–å¹»ç¯ç‰‡
    function initSlideshow() {
      // æ˜¾ç¤ºç¬¬ä¸€å¼ å›¾ç‰‡
      updateSlideshowDisplay();
      
      // å¼€å§‹è‡ªåŠ¨æ’­æ”¾
      startSlideshowAutoPlay();
    }
    
    // æ›´æ–°å¹»ç¯ç‰‡æ˜¾ç¤º
    function updateSlideshowDisplay() {
      const pig = pigResults[currentSlideshowIndex];
      
      // ä½¿ç”¨åŸæœ‰çš„å›¾ç‰‡è·¯å¾„
      const imageSrc = `image/${pig.id}.png`;
      slideshowImage.src = imageSrc;
      slideshowImage.alt = pig.name;
      slideshowTitle.textContent = pig.name;
      slideshowDescription.textContent = pig.description;
      currentIndexEl.textContent = currentSlideshowIndex + 1;
      
      // æ·»åŠ å›¾ç‰‡åŠ è½½å¤±è´¥å¤„ç†
      slideshowImage.onerror = function() {
        slideshowImage.src = 'image/pig.png';
      };
    }
    
    // å¼€å§‹å¹»ç¯ç‰‡è‡ªåŠ¨æ’­æ”¾
    function startSlideshowAutoPlay() {
      clearInterval(slideshowInterval);
      if (isSlideshowPlaying) {
        slideshowInterval = setInterval(() => {
          currentSlideshowIndex = (currentSlideshowIndex + 1) % pigResults.length;
          updateSlideshowDisplay();
        }, slideshowSpeed);
        pauseResumeBtn.textContent = 'æš‚åœ';
      }
    }
    
    // æš‚åœ/ç»§ç»­å¹»ç¯ç‰‡
    function toggleSlideshowPlay() {
      isSlideshowPlaying = !isSlideshowPlaying;
      if (isSlideshowPlaying) {
        startSlideshowAutoPlay();
        pauseResumeBtn.textContent = 'æš‚åœ';
      } else {
        clearInterval(slideshowInterval);
        pauseResumeBtn.textContent = 'ç»§ç»­';
      }
    }
    
    // æ˜¾ç¤ºä¸Šä¸€å¼ å›¾ç‰‡
    function showPrevPig() {
      currentSlideshowIndex = currentSlideshowIndex > 0 ? currentSlideshowIndex - 1 : pigResults.length - 1;
      updateSlideshowDisplay();
    }
    
    // æ˜¾ç¤ºä¸‹ä¸€å¼ å›¾ç‰‡
    function showNextPig() {
      currentSlideshowIndex = (currentSlideshowIndex + 1) % pigResults.length;
      updateSlideshowDisplay();
    }
    
    // æ‰“å¼€å¹»ç¯ç‰‡
    function openSlideshow() {
      slideshowModal.classList.add('active');
      document.body.style.overflow = 'hidden'; // é˜²æ­¢èƒŒæ™¯æ»šåŠ¨
      
      // é‡ç½®åˆ°ç¬¬ä¸€å¼ 
      currentSlideshowIndex = 0;
      updateSlideshowDisplay();
      
      // ç¡®ä¿è‡ªåŠ¨æ’­æ”¾
      isSlideshowPlaying = true;
      startSlideshowAutoPlay();
    }
    
    // å…³é—­å¹»ç¯ç‰‡
    function closeSlideshow() {
      slideshowModal.classList.remove('active');
      document.body.style.overflow = 'auto'; // æ¢å¤èƒŒæ™¯æ»šåŠ¨
      clearInterval(slideshowInterval);
    }
    
    // åŸæœ‰çš„æµ‹è¯•åŠŸèƒ½ä¿æŒä¸å˜
    function setupOriginalTest() {
      // é•¿æŒ‰å¼€å§‹äº‹ä»¶
      function handleHoldStart(e) {
        e.preventDefault();
        if (localStorage.getItem('pigTestResult')) return;
        
        isHolding = true;
        startTime = Date.now();
        
        progressText.classList.remove('hidden');
        pressHint.classList.add('hidden');
        instruction.textContent = 'æ­£åœ¨æµ‹è¯•ä¸­...';
        
        progressInterval = setInterval(updateProgress, 30);
        testArea.classList.add('scale-105');
        testArea.style.transition = 'transform 0.2s';
      }
      
      // é•¿æŒ‰ç»“æŸäº‹ä»¶
      function handleHoldEnd() {
        if (localStorage.getItem('pigTestResult')) return;
        
        isHolding = false;
        clearInterval(progressInterval);
        resetProgress();
        testArea.classList.remove('scale-105');
        instruction.textContent = 'é•¿æŒ‰å±å¹•ä¸­é—´åŒºåŸŸï¼Œçœ‹çœ‹ä½ æ˜¯ä»€ä¹ˆçŒªï¼';
      }
      
      // æ›´æ–°è¿›åº¦æ¡
      function updateProgress() {
        if (!isHolding) return;
        
        const elapsedTime = Date.now() - startTime;
        const progress = Math.min(elapsedTime / requiredHoldTime, 1);
        const offset = circumference - (progress * circumference);
        
        progressCircle.style.strokeDashoffset = offset;
        const percentage = Math.round(progress * 100);
        progressPercentage.textContent = `${percentage}%`;
        
        if (progress >= 1) {
          clearInterval(progressInterval);
          generateResult();
        }
      }
      
      // é‡ç½®è¿›åº¦æ¡
      function resetProgress() {
        clearInterval(progressInterval);
        progressCircle.style.strokeDashoffset = circumference;
        progressText.classList.add('hidden');
        pressHint.classList.remove('hidden');
        progressPercentage.textContent = '0%';
      }
      
      // ç”Ÿæˆéšæœºç»“æœ
      function generateResult() {
        try {
          playSound('complete');
          const randomIndex = Math.floor(Math.random() * pigResults.length);
          const result = pigResults[randomIndex];
          localStorage.setItem('pigTestResult', JSON.stringify(result));
          showResult(result);
        } catch (error) {
          console.error('ç”Ÿæˆç»“æœå¤±è´¥:', error);
          alert('ç”Ÿæˆç»“æœå¤±è´¥ï¼Œè¯·é‡è¯•ï¼');
          resetProgress();
          instruction.textContent = 'é•¿æŒ‰å±å¹•ä¸­é—´åŒºåŸŸï¼Œçœ‹çœ‹ä½ æ˜¯ä»€ä¹ˆçŒªï¼';
        }
      }
      
      // æ˜¾ç¤ºç»“æœ
      function showResult(result) {
        testArea.classList.add('hidden');
        resultArea.classList.remove('hidden');
        retestButton.classList.remove('hidden');
        
        const imageSrc = `image/${result.id}.png`;
        resultEmoji.src = imageSrc;
        resultEmoji.alt = result.name;
        resultTitle.textContent = result.name;
        resultDescription.textContent = result.description;
        
        resultEmoji.onerror = function() {
          resultEmoji.src = 'image/pig.png';
        };
        
        resultArea.style.opacity = '0';
        resultArea.style.transform = 'translateY(20px)';
        resultArea.style.transition = 'opacity 0.5s, transform 0.5s';
        
        setTimeout(() => {
          resultArea.style.opacity = '1';
          resultArea.style.transform = 'translateY(0)';
        }, 10);
      }
      
      // é‡æ–°æµ‹è¯•
      function handleRetest() {
        try {
          localStorage.removeItem('pigTestResult');
          resetProgress();
          testArea.classList.remove('hidden');
          resultArea.classList.add('hidden');
          retestButton.classList.add('hidden');
          instruction.textContent = 'é•¿æŒ‰å±å¹•ä¸­é—´åŒºåŸŸï¼Œçœ‹çœ‹ä½ æ˜¯ä»€ä¹ˆçŒªï¼';
        } catch (error) {
          console.error('é‡æ–°æµ‹è¯•å¤±è´¥:', error);
        }
      }
      
      // æ·»åŠ äº‹ä»¶ç›‘å¬
      const progressContainer = document.querySelector('.progress-container');
      if (progressContainer) {
        progressContainer.addEventListener('mousedown', handleHoldStart);
        progressContainer.addEventListener('touchstart', handleHoldStart);
      }
      
      document.addEventListener('mouseup', handleHoldEnd);
      document.addEventListener('touchend', handleHoldEnd);
      document.addEventListener('touchcancel', handleHoldEnd);
      
      retestButton.addEventListener('click', handleRetest);
    }
    
    // æ’­æ”¾éŸ³æ•ˆ
    function playSound(type) {
      try {
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        const audioCtx = new AudioContext();
        const oscillator = audioCtx.createOscillator();
        const gainNode = audioCtx.createGain();
        
        oscillator.connect(gainNode);
        gainNode.connect(audioCtx.destination);
        
        if (type === 'complete') {
          oscillator.type = 'sine';
          oscillator.frequency.setValueAtTime(523.25, audioCtx.currentTime);
          oscillator.frequency.setValueAtTime(659.25, audioCtx.currentTime + 0.1);
          oscillator.frequency.setValueAtTime(783.99, audioCtx.currentTime + 0.2);
          
          gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
          gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
          
          oscillator.start(audioCtx.currentTime);
          oscillator.stop(audioCtx.currentTime + 0.3);
        }
      } catch (error) {
        console.error('æ’­æ”¾éŸ³æ•ˆå¤±è´¥:', error);
      }
    }
    
    // äº‹ä»¶ç›‘å¬
    function setupEventListeners() {
      // å¹»ç¯ç‰‡æŒ‰é’®
      startSlideshowBtn.addEventListener('click', openSlideshow);
      
      // å¹»ç¯ç‰‡æ§åˆ¶
      prevPigBtn.addEventListener('click', () => {
        showPrevPig();
        // æš‚åœä¸€ä¸‹è‡ªåŠ¨æ’­æ”¾ï¼Œè®©ç”¨æˆ·æœ‰æ—¶é—´æŸ¥çœ‹
        if (isSlideshowPlaying) {
          clearInterval(slideshowInterval);
          setTimeout(startSlideshowAutoPlay, 3000);
        }
      });
      
      nextPigBtn.addEventListener('click', () => {
        showNextPig();
        // æš‚åœä¸€ä¸‹è‡ªåŠ¨æ’­æ”¾ï¼Œè®©ç”¨æˆ·æœ‰æ—¶é—´æŸ¥çœ‹
        if (isSlideshowPlaying) {
          clearInterval(slideshowInterval);
          setTimeout(startSlideshowAutoPlay, 3000);
        }
      });
      
      pauseResumeBtn.addEventListener('click', toggleSlideshowPlay);
      
      closeSlideshowBtn.addEventListener('click', closeSlideshow);
      
      // ç‚¹å‡»æ¨¡æ€æ¡†èƒŒæ™¯å…³é—­
      slideshowModal.addEventListener('click', (e) => {
        if (e.target === slideshowModal) {
          closeSlideshow();
        }
      });
      
      // é”®ç›˜æ§åˆ¶
      document.addEventListener('keydown', (e) => {
        if (slideshowModal.classList.contains('active')) {
          switch(e.key) {
            case 'ArrowLeft':
              prevPigBtn.click();
              break;
            case 'ArrowRight':
              nextPigBtn.click();
              break;
            case ' ':
              pauseResumeBtn.click();
              break;
            case 'Escape':
              closeSlideshow();
              break;
          }
        }
      });
    }
    
    // åˆå§‹åŒ–åº”ç”¨
    init();
    setupOriginalTest();
    setupEventListeners();
  </script>
</body>
</html>
